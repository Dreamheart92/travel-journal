import{j as l,F as q,r as m,E as I,t as y,v as F,w as A,W as x,A as E,b as M,g as V,c as H,C as g}from"./index-CEjWu8zT.js";import{n as z}from"./stringUtils-CSt2nhWB.js";const j="_form_7arb3_1",G={form:j,"error-container":"_error-container_7arb3_16"};function K({fieldProps:e}){const{name:t,placeholder:a,onChange:n,onBlur:s,value:o,type:r="text",inputClassName:i}=e;return l.jsx("input",{className:i,name:t,id:t,placeholder:a,onChange:n,onBlur:s,value:o,type:r})}var L={},T={};(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="fas",a="file-arrow-up",n=384,s=512,o=["file-upload"],r="f574",i="M64 0C28.7 0 0 28.7 0 64L0 448c0 35.3 28.7 64 64 64l256 0c35.3 0 64-28.7 64-64l0-288-128 0c-17.7 0-32-14.3-32-32L224 0 64 0zM256 0l0 128 128 0L256 0zM216 408c0 13.3-10.7 24-24 24s-24-10.7-24-24l0-102.1-31 31c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l72-72c9.4-9.4 24.6-9.4 33.9 0l72 72c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-31-31L216 408z";e.definition={prefix:t,iconName:a,icon:[n,s,o,r,i]},e.faFileArrowUp=e.definition,e.prefix=t,e.iconName=a,e.width=n,e.height=s,e.ligatures=o,e.unicode=r,e.svgPathData=i,e.aliases=o})(T);(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=T;e.definition={prefix:t.prefix,iconName:t.iconName,icon:[t.width,t.height,t.aliases,t.unicode,t.svgPathData]},e.faFileUpload=e.definition,e.prefix=t.prefix,e.iconName=t.iconName,e.width=t.width,e.height=t.height,e.ligatures=t.aliases,e.unicode=t.unicode,e.svgPathData=t.svgPathData,e.aliases=t.aliases})(L);const W="_account_6xeb4_35",b={"image-wrapper":"_image-wrapper_6xeb4_1","icon-upload":"_icon-upload_6xeb4_9",account:W};function Y({fieldProps:e}){const{value:t,onChange:a,name:n,placeholder:s,userProfileImage:o=!1}=e,r=`${o?b.account:b.journal}`,i=f=>{f.preventDefault(),document.getElementById("file").click()};let c;return t?t instanceof File?c=URL.createObjectURL(t):c=t:c=o?"/userPlaceholder.png":"/placeholder-image.jpg",l.jsxs("div",{className:b["image-wrapper"],children:[l.jsx("img",{onClick:i,className:r,src:c,alt:""}),l.jsx(q,{onClick:i,className:b["icon-upload"],icon:L.faFileUpload}),l.jsx("input",{type:"file",id:"file",name:n,placeholder:s,onChange:a,hidden:!0,accept:".jpg, .jpeg"})]})}const Z="_label_1am98_7",Q="_field_1am98_12",X="_success_1am98_24",ee="_error_1am98_28",te="_column_1am98_33",ae="_row_1am98_37",ne="_date_1am98_41",se="_select_1am98_47",N={"input-wrapper":"_input-wrapper_1am98_1",label:Z,field:Q,success:X,error:ee,column:te,row:ae,date:ne,select:se};function oe({fieldProps:e}){const{value:t,onChange:a,onBlur:n,options:s,inputClassName:o}=e;return l.jsxs("select",{className:`${o} ${N.select}`,value:t,onChange:a,onBlur:n,name:"destination",children:[l.jsx("option",{value:"",disabled:!0,children:"Select a destination"}),s.map(r=>l.jsx("option",{value:r._id,children:z(r.name)},r._id))]})}function re({fieldProps:e}){const{value:t,onChange:a,onBlur:n,name:s,inputClassName:o}=e,r=t,i=r?r.slice(0,10):null;return l.jsx("input",{className:`${N.date} ${o}`,onChange:a,onBlur:n,defaultValue:i,name:s,id:"date",type:"date"})}function ie({fieldProps:e}){const{name:t,value:a,onChange:n,onBlur:s,placeholder:o,inputClassName:r}=e;return l.jsx("textarea",{className:r,onChange:n,onBlur:s,value:a,name:t,placeholder:o,rows:"10",cols:"50"})}const P="INIT_FORM_STATE",U="HANDLE_CHANGE",k="HANDLE_BLUR",B="RESET_FIELD",J="HANDLE_SUBMIT",ce=(e,t)=>{const a=[];return e.forEach(n=>{const[s,o]=Object.entries(n),[r,i]=s,c=(o==null?void 0:o[1])||`${r} error`;switch(r){case"required":{t instanceof File?t.name.trim()===""&&a.push(c):typeof t.formatted_address>"u"&&i&&t.trim()===""&&a.push(c);break}case"minLength":{t.length<i&&a.push(c);break}case"maxLength":{t.length>i&&a.push(c);break}case"email":{const f=/^[a-zA-Z0-9]+@[a-z]+.[a-z]{2,5}$/;t.match(f)===null&&a.push(c);break}}}),a},R=e=>{const t={};let a=!0;return Object.entries(e).forEach(([n,s])=>{const{value:o}=s.state,{validators:r}=s,i=ce(r,o);i.length>0&&a&&(a=!1),t[n]=i}),{errors:t,isValidForm:a}};function le(e,t){switch(t.type){case P:{const{initialState:a}=t.payload,{errors:n}=R(a);return{...e,formState:a,errors:n}}case U:{const{event:a}=t.payload,n=a.target.name,s=a.target.type==="file"?a.target.files[0]||"":a.target.value,{formState:o}=e;o[n].state={value:s,isDirty:!0};const{errors:r,isValidForm:i}=R(e.formState);return{...e,errors:r,formState:o,isValidForm:i}}case k:{const{event:a}=t.payload,n=a.target.name,{isDirty:s}=e.formState[n].state;return s?e:{...e,formState:{...e.formState,[n]:{...e.formState[n],state:{value:e.formState[n].state.value,isDirty:!0}}}}}case B:{const{fieldName:a}=t.payload;return{...e,errors:{...e.errors,[a]:[]},formState:{...e.formState,[a]:{...e.formState[a],state:{value:"",isDirty:!1}}},isSubmitted:!1,isValidForm:!1}}case J:return{...e,isSubmitted:!0,hasBeenSubmitted:!0};default:throw new Error("Invalid action")}}const ue=e=>({initFormState:t=>{e({type:P,payload:{initialState:t}})},onChange:t=>{e({type:U,payload:{event:t}})},onBlur:t=>{e({type:k,payload:{event:t}})},resetField:t=>{e({type:B,payload:{fieldName:t}})},onSubmit:()=>{e({type:J})}}),de=ue,me=e=>({formState:()=>e.formState,getFieldError:t=>e.errors[t],getFieldValue:t=>e.formState[t].state.value,isSubmitted:()=>e.isSubmitted,isValidForm:()=>e.isValidForm,hasBeenSubmitted:()=>e.hasBeenSubmitted}),fe=me,O=m.createContext(),pe={formState:{},errors:{},isValidForm:!1,isSubmitted:!1,hasBeenSubmitted:!1};function xe({children:e}){const[t,a]=m.useReducer(le,pe),n=m.useMemo(()=>[t,a],[t]);return l.jsx(O.Provider,{value:n,children:e})}function $(){const e=m.useContext(O);if(!e)throw new Error("useFormContext must be used within a FormProvider");const[t,a]=e,n=de(a),s=fe(t);return{state:t,formContextActions:n,formContextSelectors:s}}const ge={fields:["geometry","name","formatted_address"]};function he({fieldProps:e}){const{name:t,onChange:a,onBlur:n,inputClassName:s,placeholder:o,value:r}=e,i=m.useRef(null),[c,f]=m.useState((r==null?void 0:r.formatted_address)||""),h=m.useRef(!1),p=m.useRef(null);m.useEffect(()=>{if(!i.current)return;const u=new window.google.maps.places.Autocomplete(i.current,ge);u.addListener("place_changed",()=>{f(u.getPlace().formatted_address);const S=u.getPlace(),v={formatted_address:S.formatted_address,lat:S.geometry.location.lat(),lng:S.geometry.location.lng()};h.current=!0,a({target:{name:"location",value:v}})})},[i]);const _=u=>{f(u.target.value),u.target.value===""&&a(u)},d=u=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{h.current||n(u)},200)};return l.jsx("input",{className:s,name:t,type:"text",ref:i,value:c,onBlur:d,onInput:_,placeholder:o})}function Se({name:e,placeholder:t,label:a,inputType:n,type:s,userProfileImage:o,options:r}){const{formContextActions:i,formContextSelectors:c}=$(),f=c.formState(),h=c.isSubmitted(),{value:p,isDirty:_}=f[e].state,d=c.getFieldError(e),u=d.length>0?d[0]:null,S=u&&(_||h),v=`${N.field} ${S?N.error:null}`,C={value:p,onChange:i.onChange,onBlur:i.onBlur,inputClassName:v,name:e,placeholder:t,type:s,userProfileImage:o,label:a,options:r},w=n==="text"&&K||n==="file"&&Y||n==="select"&&oe||n==="date"&&re||n==="text-area"&&ie||n==="location-autocomplete"&&he;return l.jsxs("div",{className:N["input-wrapper"],children:[a&&l.jsx("label",{className:N.label,htmlFor:e,children:a}),l.jsx(w,{fieldProps:C}),S&&l.jsx(I,{message:u})]})}function _e({children:e,submitCallback:t,error:a,layoutStyle:n}){const[s,o]=m.useState(!1),{formContextActions:r,formContextSelectors:i}=$(),c=f=>{if(f.preventDefault(),r.onSubmit(),i.isValidForm()){const h=Object.entries(i.formState()).reduce((p,[_,d])=>{const{value:u}=d.state;return{...p,[_]:u}},{});t(h)}};return m.useEffect(()=>{const f=m.Children.toArray(e),h={},p=_=>{_.forEach(d=>{var u,S;if(((u=d.type)==null?void 0:u.name)==="FormInput"){const{name:v,initialValue:C="",validators:w=[]}=d.props;h[v]={state:{value:C,isDirty:!1},validators:w}}else typeof((S=d==null?void 0:d.props)==null?void 0:S.children)<"u"&&p(m.Children.toArray(d.props.children))})};p(f),r.initFormState(h),o(!0)},[]),l.jsxs("form",{style:n,onSubmit:c,className:G.form,children:[a&&l.jsx(I,{message:a.message}),s&&e]})}_e.Input=Se;const D=e=>{const t=new FormData;return t.append("image",e.image),t.append("description",e.description),t.append("title",e.title),t.append("location",JSON.stringify(e.location)),t.append("date",e.date),t.append("destination",e.destination),t},Ne=e=>{const t=new FormData;return t.append("image",e.image),t.append("username",e.username),t.append("firstName",e.firstName),t.append("lastName",e.lastName),t.append("email",e.email),t},Le=e=>{var t;return{title:(e==null?void 0:e.title)||"",image:(e==null?void 0:e.imageUrl)||"",location:(e==null?void 0:e.location)||"",date:(e==null?void 0:e.date)||"",description:(e==null?void 0:e.description)||"",destination:((t=e==null?void 0:e.destination)==null?void 0:t._id)||""}},Te=e=>({email:(e==null?void 0:e.email)||"",username:(e==null?void 0:e.username)||"",firstName:(e==null?void 0:e.firstName)||"",lastName:(e==null?void 0:e.lastName)||"",image:(e==null?void 0:e.imageUrl)||""}),ye=e=>({email:e.email,password:e.password}),Ae=e=>({email:e.email,username:e.username,firstName:e.firstName,lastName:e.lastName,password:e.password}),Ee=y("crud/thunk/postJournalRequest",async(e,{dispatch:t,signal:a})=>{const{journalData:n}=e,{accessToken:s}=F(),o={method:"Post",headers:{Authorization:s},body:n},r=await A(E.JOURNAL.JOURNAL,o);return t(x.updateDestinationCount({destinationId:r.data.destination,isAdding:!0})),r.data}),ve=y("crud/thunk/updateJournalRequest",async(e,{signal:t})=>{const{accessToken:a}=F(),{journalData:n,journalId:s}=e.journalMetaData,o={method:"Put",headers:{Authorization:a},body:n};return(await A(`${E.JOURNAL.JOURNAL}/${s}`,o)).data}),be=y("crud/thunk/deleteJournalRequest",async(e,{dispatch:t,signal:a})=>{const{journalId:n,destinationId:s}=e,{accessToken:o}=F(),r={method:"Delete",headers:{Authorization:o}};try{return await A(`${E.JOURNAL.JOURNAL}/${n}`,r),t(x.updateDestinationCount({destinationId:s,isAdding:!1})),{success:!0}}catch(i){throw i}}),Fe=y("crud/thunk/updateProfileRequest",async(e,{signal:t})=>{const{userData:a}=e,{accessToken:n}=F(),s={method:"Put",headers:{Authorization:n},body:a};return(await A(E.AUTH.UPDATE_PROFILE,s)).data}),Ce=y("crud/thunk/sendLoginRequest",async(e,{signal:t})=>{const{loginData:a}=e,n={method:"Post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)};return(await A(E.AUTH.LOGIN,n)).data}),we=y("crud/thunk/sendSignupRequest",async(e,{signal:t})=>{const{signupData:a}=e,n={method:"Post",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)};return(await A(E.AUTH.SIGNUP,n)).data}),Re=e=>{const t=M(),a=V(s=>s.crud[e]);let n;switch(e){case g.CREATE:{n={postJournal:s=>t(Ee({key:g.CREATE,journalData:D(s)})),signup:s=>t(we({key:g.CREATE,signupData:Ae(s)}))};break}case g.READ:{n={login:s=>{t(Ce({key:g.READ,loginData:ye(s)}))}};break}case g.UPDATE:{n={updateJournal:(s,o)=>{t(ve({key:g.UPDATE,journalMetaData:{journalData:D(s),journalId:o}}))},updateProfile:s=>{t(Fe({key:g.UPDATE,userData:Ne(s)}))}};break}case g.DELETE:{n={deleteJournal:({journalId:s,destinationId:o})=>t(be({key:g.DELETE,journalId:s,destinationId:o}))};break}}return n.resetState=()=>t(H.resetState()),{...a,...n}},Pe=Re;export{_e as F,xe as a,$ as b,Le as c,Te as d,Pe as u};

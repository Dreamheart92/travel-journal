import{j as t,o as A,B as u,G,M as H,u as T,e as K,P as C,b as y,p as S,q as L,C as O,c as I,F as x,t as N,v as D,w,A as b,i as f,O as j,g as M,m as Y,U as W,x as Q,y as V,n as X,z as Z,r as ee,J as te,D as ne,k as se,E as ce}from"./index-CEjWu8zT.js";import{u as ae,F as k,a as oe}from"./useCrud-6uD_6Pwn.js";import{J as ie,f as re,c as le}from"./index-rhvUK8Cb.js";import{u as me}from"./useForm-BSh5y4x3.js";import{s as de,f as ue}from"./stringUtils-CSt2nhWB.js";const he="_container_14nxc_1",fe={container:he},Ce="_controls_6r2u8_1",_e={controls:Ce};function $({text:e,onDelete:n,onCloseModal:o,isDeleting:s}){return t.jsxs(A,{children:[t.jsx("h3",{children:e}),t.jsxs("div",{className:_e.controls,children:[t.jsx(u,{onClick:n,variant:"warning",caption:"Delete",isLoading:s}),t.jsx(u,{onClick:o,variant:"secondary",caption:"Cancel"})]})]})}const pe="_controls_t4jdz_7",E={"journal-image-wrapper":"_journal-image-wrapper_t4jdz_1",controls:pe},je={width:"100%",height:"300px"};function ge({center:e}){return t.jsx(G,{mapContainerStyle:je,center:e,zoom:5,children:t.jsx(H,{position:e})})}function ve({journal:e,onOpenModal:n}){const o=T();return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:E["journal-image-wrapper"],children:[t.jsx(K,{imageUrl:e.imageUrl}),e.isJournalOwner&&t.jsxs("div",{className:E.controls,children:[t.jsx(u,{onClick:()=>o(`${C.EDIT}/${e._id}`),variant:"secondary",caption:"Edit"}),t.jsx(u,{onClick:()=>n(),variant:"warning",caption:"Delete"})]})]}),t.jsx(ie,{journal:e}),t.jsx(ge,{center:{lat:Number(e.location.lat),lng:Number(e.location.lng)}})]})}function xe({journal:e}){const n=y(),o=T(),{isOpen:s,onOpenModal:c,onCloseModal:a}=S(),{loading:r,deleteJournal:i}=ae(O.DELETE),l=async()=>{var d;const m=await i({journalId:e._id,destinationId:e.destination._id});(d=m==null?void 0:m.payload)!=null&&d.success&&(n(I.resetState({key:O.DELETE})),o(C.CATALOGUE))};return t.jsxs("div",{className:fe.container,children:[t.jsx(ve,{journal:e,onOpenModal:c}),t.jsx(L,{isOpen:s,children:t.jsx($,{text:"Are you sure you want to delete this journal?",isDeleting:r,onCloseModal:a,onDelete:l})})]})}const Me={"leave-comment":"_leave-comment_gdpsn_1"};function Te({user:e}){const n=e?"Leave a comment":"Login to leave a comment";return t.jsxs("div",{className:Me["leave-comment"],children:[t.jsx(x,{icon:re.faComments}),t.jsx("h5",{children:n})]})}const ye={"comments-count":"_comments-count_euwi4_1"},Ne="_container_6v7mn_1",De="_button_6v7mn_9",we={container:Ne,button:De};function be({onCreateCommentSubmit:e}){const[n]=me(),o=s=>{e(s.comment),n.resetField("comment")};return t.jsx("div",{className:we.container,children:t.jsxs(k,{submitCallback:o,children:[t.jsx(k.Input,{name:"comment",inputType:"text-area",validators:[{required:!0,message:"Please enter your comment before submitting"}]}),t.jsx(u,{submitButton:!0,caption:"Comment"})]})})}const Oe=N("optimistic",async(e,{dispatch:n,signal:o})=>{const{accessToken:s}=D(),{reactionType:c,isReacted:a,commentId:r,userId:i}=e.reactionMetaData,l=c==="likes"?"like":"dislike",d={method:a?"Delete":"Get",headers:{Authorization:s}};return(await w(`${b.COMMENTS.COMMENTS}/${l}/${r}`,d)).data}),ke=N("optimistic",async(e,{dispatch:n,signal:o})=>{const{commentData:s,journalId:c}=e.commentMetaData,{accessToken:a}=D(),r={method:"Post",headers:{Authorization:a,"Content-Type":"application/json"},body:JSON.stringify(s)};return(await w(`${b.COMMENTS.COMMENTS}/${c}`,r)).data}),Ee=N("optimistic",async(e,{dispatch:n,signal:o})=>{const{commentId:s,journalId:c}=e,{accessToken:a}=D(),r={method:"Delete",headers:{Authorization:a}};try{return await w(`${b.COMMENTS.COMMENTS}/${c}/${s}`,r),{success:!0}}catch(i){throw i}}),Ae=()=>{const e=y();return{postCommentOptimistic:(c,a)=>{e(f.addLocalComment(c)),e(ke({key:j.POST_COMMENT,commentMetaData:{commentData:{comment:c.comment,createdAt:c.createdAt},journalId:a}}))},deleteCommentOptimistic:({commentId:c,journalId:a})=>{e(f.deleteLocalComment({commentId:c})),e(Ee({key:j.DELETE_COMMENT,commentId:c,journalId:a}))},postCommentReactionOptimistic:c=>{const{reactionType:a,isReacted:r,commentId:i,userId:l}=c;e(f.updateLocalCommentReaction({reactionType:a,isReacted:r,commentId:i,userId:l})),e(Oe({key:j.POST_COMMENT_REACTION,reactionMetaData:{reactionType:a,isReacted:r,commentId:i,userId:l}}))}}},P=Ae,Se="_content_casp8_1",Le="_author_casp8_7",g={content:Se,author:Le,"comment-date":"_comment-date_casp8_11"};function Ie({author:e,createdAt:n,content:o,id:s}){return t.jsxs("div",{className:g.content,children:[t.jsx("h4",{className:g.author,children:e}),t.jsx("p",{className:g["comment-date"],children:le(n)}),de(o).map((c,a)=>t.jsx("p",{children:c},a))]})}const $e="_wrapper_1cexf_11",v={"comment-card":"_comment-card_1cexf_1",wrapper:$e,"delete-control":"_delete-control_1cexf_19"};var R={};(function(e){Object.defineProperty(e,"__esModule",{value:!0});var n="fas",o="thumbs-up",s=512,c=512,a=[128077,61575],r="f164",i="M313.4 32.9c26 5.2 42.9 30.5 37.7 56.5l-2.3 11.4c-5.3 26.7-15.1 52.1-28.8 75.2l144 0c26.5 0 48 21.5 48 48c0 18.5-10.5 34.6-25.9 42.6C497 275.4 504 288.9 504 304c0 23.4-16.8 42.9-38.9 47.1c4.4 7.3 6.9 15.8 6.9 24.9c0 21.3-13.9 39.4-33.1 45.6c.7 3.3 1.1 6.8 1.1 10.4c0 26.5-21.5 48-48 48l-97.5 0c-19 0-37.5-5.6-53.3-16.1l-38.5-25.7C176 420.4 160 390.4 160 358.3l0-38.3 0-48 0-24.9c0-29.2 13.3-56.7 36-75l7.4-5.9c26.5-21.2 44.6-51 51.2-84.2l2.3-11.4c5.2-26 30.5-42.9 56.5-37.7zM32 192l64 0c17.7 0 32 14.3 32 32l0 224c0 17.7-14.3 32-32 32l-64 0c-17.7 0-32-14.3-32-32L0 224c0-17.7 14.3-32 32-32z";e.definition={prefix:n,iconName:o,icon:[s,c,a,r,i]},e.faThumbsUp=e.definition,e.prefix=n,e.iconName=o,e.width=s,e.height=c,e.ligatures=a,e.unicode=r,e.svgPathData=i,e.aliases=a})(R);const Pe={prefix:"far",iconName:"thumbs-up",icon:[512,512,[128077,61575],"f164","M323.8 34.8c-38.2-10.9-78.1 11.2-89 49.4l-5.7 20c-3.7 13-10.4 25-19.5 35l-51.3 56.4c-8.9 9.8-8.2 25 1.6 33.9s25 8.2 33.9-1.6l51.3-56.4c14.1-15.5 24.4-34 30.1-54.1l5.7-20c3.6-12.7 16.9-20.1 29.7-16.5s20.1 16.9 16.5 29.7l-5.7 20c-5.7 19.9-14.7 38.7-26.6 55.5c-5.2 7.3-5.8 16.9-1.7 24.9s12.3 13 21.3 13L448 224c8.8 0 16 7.2 16 16c0 6.8-4.3 12.7-10.4 15c-7.4 2.8-13 9-14.9 16.7s.1 15.8 5.3 21.7c2.5 2.8 4 6.5 4 10.6c0 7.8-5.6 14.3-13 15.7c-8.2 1.6-15.1 7.3-18 15.2s-1.6 16.7 3.6 23.3c2.1 2.7 3.4 6.1 3.4 9.9c0 6.7-4.2 12.6-10.2 14.9c-11.5 4.5-17.7 16.9-14.4 28.8c.4 1.3 .6 2.8 .6 4.3c0 8.8-7.2 16-16 16l-97.5 0c-12.6 0-25-3.7-35.5-10.7l-61.7-41.1c-11-7.4-25.9-4.4-33.3 6.7s-4.4 25.9 6.7 33.3l61.7 41.1c18.4 12.3 40 18.8 62.1 18.8l97.5 0c34.7 0 62.9-27.6 64-62c14.6-11.7 24-29.7 24-50c0-4.5-.5-8.8-1.3-13c15.4-11.7 25.3-30.2 25.3-51c0-6.5-1-12.8-2.8-18.7C504.8 273.7 512 257.7 512 240c0-35.3-28.6-64-64-64l-92.3 0c4.7-10.4 8.7-21.2 11.8-32.2l5.7-20c10.9-38.2-11.2-78.1-49.4-89zM32 192c-17.7 0-32 14.3-32 32L0 448c0 17.7 14.3 32 32 32l64 0c17.7 0 32-14.3 32-32l0-224c0-17.7-14.3-32-32-32l-64 0z"]};var z={};(function(e){Object.defineProperty(e,"__esModule",{value:!0});var n="fas",o="thumbs-down",s=512,c=512,a=[128078,61576],r="f165",i="M313.4 479.1c26-5.2 42.9-30.5 37.7-56.5l-2.3-11.4c-5.3-26.7-15.1-52.1-28.8-75.2l144 0c26.5 0 48-21.5 48-48c0-18.5-10.5-34.6-25.9-42.6C497 236.6 504 223.1 504 208c0-23.4-16.8-42.9-38.9-47.1c4.4-7.3 6.9-15.8 6.9-24.9c0-21.3-13.9-39.4-33.1-45.6c.7-3.3 1.1-6.8 1.1-10.4c0-26.5-21.5-48-48-48l-97.5 0c-19 0-37.5 5.6-53.3 16.1L202.7 73.8C176 91.6 160 121.6 160 153.7l0 38.3 0 48 0 24.9c0 29.2 13.3 56.7 36 75l7.4 5.9c26.5 21.2 44.6 51 51.2 84.2l2.3 11.4c5.2 26 30.5 42.9 56.5 37.7zM32 384l64 0c17.7 0 32-14.3 32-32l0-224c0-17.7-14.3-32-32-32L32 96C14.3 96 0 110.3 0 128L0 352c0 17.7 14.3 32 32 32z";e.definition={prefix:n,iconName:o,icon:[s,c,a,r,i]},e.faThumbsDown=e.definition,e.prefix=n,e.iconName=o,e.width=s,e.height=c,e.ligatures=a,e.unicode=r,e.svgPathData=i,e.aliases=a})(z);var F={};(function(e){Object.defineProperty(e,"__esModule",{value:!0});var n="far",o="thumbs-down",s=512,c=512,a=[128078,61576],r="f165",i="M323.8 477.2c-38.2 10.9-78.1-11.2-89-49.4l-5.7-20c-3.7-13-10.4-25-19.5-35l-51.3-56.4c-8.9-9.8-8.2-25 1.6-33.9s25-8.2 33.9 1.6l51.3 56.4c14.1 15.5 24.4 34 30.1 54.1l5.7 20c3.6 12.7 16.9 20.1 29.7 16.5s20.1-16.9 16.5-29.7l-5.7-20c-5.7-19.9-14.7-38.7-26.6-55.5c-5.2-7.3-5.8-16.9-1.7-24.9s12.3-13 21.3-13L448 288c8.8 0 16-7.2 16-16c0-6.8-4.3-12.7-10.4-15c-7.4-2.8-13-9-14.9-16.7s.1-15.8 5.3-21.7c2.5-2.8 4-6.5 4-10.6c0-7.8-5.6-14.3-13-15.7c-8.2-1.6-15.1-7.3-18-15.2s-1.6-16.7 3.6-23.3c2.1-2.7 3.4-6.1 3.4-9.9c0-6.7-4.2-12.6-10.2-14.9c-11.5-4.5-17.7-16.9-14.4-28.8c.4-1.3 .6-2.8 .6-4.3c0-8.8-7.2-16-16-16l-97.5 0c-12.6 0-25 3.7-35.5 10.7l-61.7 41.1c-11 7.4-25.9 4.4-33.3-6.7s-4.4-25.9 6.7-33.3l61.7-41.1c18.4-12.3 40-18.8 62.1-18.8L384 32c34.7 0 62.9 27.6 64 62c14.6 11.7 24 29.7 24 50c0 4.5-.5 8.8-1.3 13c15.4 11.7 25.3 30.2 25.3 51c0 6.5-1 12.8-2.8 18.7C504.8 238.3 512 254.3 512 272c0 35.3-28.6 64-64 64l-92.3 0c4.7 10.4 8.7 21.2 11.8 32.2l5.7 20c10.9 38.2-11.2 78.1-49.4 89zM32 384c-17.7 0-32-14.3-32-32L0 128c0-17.7 14.3-32 32-32l64 0c17.7 0 32 14.3 32 32l0 224c0 17.7-14.3 32-32 32l-64 0z";e.definition={prefix:n,iconName:o,icon:[s,c,a,r,i]},e.faThumbsDown=e.definition,e.prefix=n,e.iconName=o,e.width=s,e.height=c,e.ligatures=a,e.unicode=r,e.svgPathData=i,e.aliases=a})(F);const Re="_reaction_1xnz5_1",ze={reaction:Re};function Fe({isLikedComment:e,isDislikedComment:n,likes:o,dislikes:s,onCommentReaction:c}){return t.jsxs("div",{className:ze.reaction,children:[t.jsxs("div",{onClick:()=>c("likes",e),children:[t.jsx(x,{icon:e?R.faThumbsUp:Pe,style:{color:"#3b82f6"}}),t.jsx("span",{children:o})]}),t.jsxs("div",{onClick:()=>c("dislikes",n),children:[t.jsx(x,{icon:n?z.faThumbsDown:F.faThumbsDown,style:{color:"#3b82f6"}}),t.jsx("span",{children:s})]})]})}function Ue({comment:e,userId:n,onSetModalTargetItemId:o}){const s=T(),{author:c,createdAt:a,comment:r,_id:i,likes:l,dislikes:m}=e,{postCommentReactionOptimistic:d}=P(),h=M(Y),_=(q,B)=>{h?i.endsWith("___temporary")||d({reactionType:q,isReacted:B,commentId:i,userId:n}):s(C.LOGIN)},p=n&&e.author._id===n,U=l.includes(n),J=m.includes(n);return t.jsxs("div",{className:v["comment-card"],children:[t.jsx(W,{imageUrl:c.imageUrl}),t.jsxs("div",{className:v.wrapper,children:[t.jsx(Ie,{author:c.username,content:r,createdAt:a,id:i}),t.jsx(Fe,{commentId:i,isLikedComment:U,isDislikedComment:J,likes:l.length,dislikes:m.length,onCommentReaction:_}),p&&t.jsx("div",{className:v["delete-control"],children:t.jsx(u,{onClick:()=>o(i),variant:"warning",caption:"Delete"})})]})]})}const Je={"comments-list":"_comments-list_smkoh_1"};function qe({comments:e,userId:n,onSetTargetItemId:o}){return t.jsx("div",{className:Je["comments-list"],children:e.map(s=>t.jsx(Ue,{comment:s,userId:n,onSetModalTargetItemId:o},s._id))})}const Be=()=>`${Math.random()*1e3}___temporary`,Ge=(e,n)=>({_id:Be(),createdAt:String(new Date),author:e,comment:n,dislikes:[],likes:[],totalLikes:0});function He({journalId:e}){const{user:n,isAuthenticated:o}=M(Q),{comments:s}=M(V),{postCommentOptimistic:c,deleteCommentOptimistic:a}=P(),{isOpen:r,targetItemId:i,onSetTargetItemId:l,onCloseModal:m}=S(),d=async _=>{const p=Ge(n,_);c(p,e)},h=()=>{i&&(a({commentId:i,journalId:e}),m())};return t.jsxs(t.Fragment,{children:[t.jsx(Te,{user:o}),o&&t.jsx(oe,{children:t.jsx(be,{onCreateCommentSubmit:d})}),t.jsx("div",{className:ye["comments-count"],children:ue(s.results)}),t.jsx(qe,{comments:s.results,userId:n==null?void 0:n._id,onSetTargetItemId:l}),t.jsx(L,{isOpen:r,children:t.jsx($,{text:"Are you sure you want to delete this comment?",onDelete:h,onCloseModal:m})})]})}function Xe(){const{journalId:e}=X(),{journal:n,loading:o,error:s,fetchJournal:c}=Z(),a=y();return ee.useEffect(()=>{const r=c(e);return()=>{a(f.resetState({key:te.JOURNAL})),a(I.resetState()),r.abort()}},[]),(s==null?void 0:s.message)==="Journal not found"?t.jsx(ne,{to:C.NOT_FOUND}):t.jsxs(A,{customStyle:{width:"80em",minHeight:"100vh",paddingBottom:"5em"},children:[o&&t.jsx(se,{}),!o&&n&&t.jsxs(t.Fragment,{children:[t.jsx(xe,{journal:n,journalId:e}),t.jsx(He,{journalId:e})]}),s&&t.jsx(ce,{large:!0,message:"Failed to fetch journal. Please try again."})]})}export{Xe as default};
